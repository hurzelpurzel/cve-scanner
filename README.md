# cve-scanner
Simple container that helps you doing CVE Scans with grype from inside your OCP 4/ K8s cluster from the commandline in the pod


# INSTALL K8s:
- Log in as a cluster admin
- kubectl create namespace cve-scanner
- apply manifest from rbac using 
    kubectl apply -f rbac/rb-cluster-viewer.yml -n  cve-scanner
- kubectl create deployment cve-scanner-depl -n cve-scanner --image  ghcr.io/hurzelpurzel/cve-scanner:main

# INSTALL OCP:
- Log in as a cluster admin
- oc new-project cve-scanner
- apply manifest from rbac using 
    oc apply -f rbac/rb-image-auditor.yml -n  cve-scanner 
    oc apply -f rbac/rb-image-registryviewer.yml -n  cve-scanner
    oc apply -f rbac/rb-cluster-viewer.yml -n  cve-scanner
- copy pull secret
    oc get secret pull-secret -n=openshift-config -o yaml | sed --expression='s/openshift-config/cve-scanner/' | oc apply --namespace=cve-scanner -f -
    
- Add Application by using 
    oc new-app https://github.com/hurzelpurzel/cve-scanner.git -n cve-scanner --name=cve-scanner
- Mount secret (do note use this from window oc client due to path bug)
    oc set volume deployment/cve-scanner --add --name=pullsec --type=secret --secret-name='pull-secret' --mount-path=/grype_dir/dockerconfig -n cve-scanner

# Usage
Start scan.sh or scan_k8s.sh, depending if you are on OCP4 or pure k8s.
It will produce Reports files in your Workdir

# TODO: Futher step
- Create PVC for output and CVE DB
- Create Jobs for each namespace to speed up process
- Create Cronjob for DB update
